# Flutter WebView 功能测试指南

## 已实现的功能

### 1. 核心功能
- ✅ 显示谱面定数
- ✅ 计算并显示单曲 PTT
- ✅ 计算并显示总 PTT
- ✅ 显示目标分数（使 PTT +0.01）
- ✅ 显示 PTT 增长所需定数表格
- ✅ Best 30 和 Recent 10 卡片序号
- ✅ B30/R10 分隔线

### 2. 设置功能
- ✅ 显示/隐藏图表
- ✅ 显示/隐藏定数
- ✅ 显示/隐藏单曲 PTT
- ✅ 显示/隐藏目标分数
- ✅ 显示/隐藏下载按钮

### 3. UI 优化
- ✅ 响应式布局支持
- ✅ 卡片渐变背景
- ✅ 根据难度调整颜色
- ✅ 实时设置更新

## 测试步骤

### 运行应用

```bash
cd arcaea_helper_mobile

# 在模拟器/设备上运行
flutter run

# 或在 Chrome 中运行（用于调试）
flutter run -d chrome
```

### 测试流程

#### 1. 启动测试
1. 启动应用
2. 等待加载 Arcaea Online 网站
3. 登录你的账号

#### 2. 导航到 Potential 页面
1. 点击 Profile
2. 点击 Potential
3. 等待页面加载完成

#### 3. 验证功能

**基础显示功能：**
- [ ] 歌曲标题旁是否显示定数（灰色数字）
- [ ] 定数后是否显示单曲 PTT（紫色数字）
- [ ] 用户名后是否显示总 PTT
- [ ] 分数下方是否显示目标分数（绿色 >>）

**序号和分隔：**
- [ ] Best 30 卡片左上角是否显示 #1-#30（紫色背景）
- [ ] Recent 10 卡片左上角是否显示 R1-R10（橙红色背景）
- [ ] B30 和 R10 之间是否有空白分隔

**PTT 增长卡片：**
- [ ] 第一张卡片（B1）之前是否有紫色渐变卡片
- [ ] 卡片是否显示 "使显示 PTT +0.01 所需最低谱面定数"
- [ ] 表格是否显示 995W、EX+、EX、970W、960W、AA 对应的定数

#### 4. 测试设置功能

**打开设置面板：**
1. 点击右上角的设置图标
2. 设置面板应该展开

**测试每个设置：**
- [ ] 关闭"显示定数" → 定数应该消失
- [ ] 打开"显示定数" → 定数应该显示
- [ ] 关闭"显示单曲PTT" → 单曲 PTT 应该消失
- [ ] 打开"显示单曲PTT" → 单曲 PTT 应该显示
- [ ] 关闭"显示目标分数" → 目标分数应该消失
- [ ] 打开"显示目标分数" → 目标分数应该显示

**测试图表和下载按钮（如果页面有这些元素）：**
- [ ] 关闭"显示图表" → 图表应该隐藏
- [ ] 打开"显示图表" → 图表应该显示
- [ ] 关闭"显示下载按钮" → 下载按钮应该隐藏
- [ ] 打开"显示下载按钮" → 下载按钮应该显示

#### 5. 测试刷新功能
1. 点击右上角的刷新按钮
2. 页面应该重新加载
3. 所有功能应该重新生效

### 调试技巧

#### 查看控制台日志

在 Flutter 运行的终端中，你应该看到类似的日志：

```
[WebView Console] LOG: [Arcaea Helper Flutter] 🚀 脚本已加载
[WebView Console] LOG: [Arcaea Helper] 计算的总PTT: 12.3456
[WebView Console] LOG: [Arcaea Helper Flutter] ✅ 初始化完成
```

#### 常见问题排查

**问题：页面没有显示任何增强功能**

检查：
1. 确认已导航到正确的 URL（包含 `/profile/potential`）
2. 查看控制台是否有错误日志
3. 检查网络请求是否成功

**问题：设置更改后没有效果**

检查：
1. 确认看到 `[Arcaea Helper Flutter] 设置已更新` 日志
2. 确认 `window.applySettings` 函数存在
3. 尝试刷新页面

**问题：某些卡片没有显示定数**

原因：
- 数据文件中可能没有该歌曲的定数
- 歌曲名称匹配失败

检查：
1. 查看控制台是否有 "未找到歌曲" 的警告
2. 确认歌曲名称是否正确

## 性能测试

### 页面加载时间
- [ ] 初次加载时间 < 3 秒
- [ ] 脚本注入时间 < 1 秒
- [ ] 卡片处理时间 < 2 秒

### 内存使用
- [ ] 长时间运行无内存泄漏
- [ ] 切换设置时内存稳定

### 响应性
- [ ] 设置更改即时生效
- [ ] 滚动流畅无卡顿
- [ ] 点击交互响应快速

## 已知限制

1. **数据更新**：需要手动更新 `ChartConstant.json` 和 `Songlist.json`
2. **网络依赖**：需要访问 Arcaea Online 官方网站
3. **登录要求**：需要有效的 Arcaea 账号

## 下一步优化

- [ ] 添加离线数据缓存
- [ ] 支持自定义主题颜色
- [ ] 添加导出数据功能
- [ ] 优化大数据量性能
- [ ] 添加错误恢复机制

## 反馈

测试过程中遇到问题？请记录以下信息：
1. 设备型号和操作系统版本
2. Flutter 版本 (`flutter --version`)
3. 具体的错误现象
4. 控制台日志输出
5. 复现步骤

创建 GitHub Issue 或联系开发者反馈问题。
